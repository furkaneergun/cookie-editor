function CookieHandler(){"use strict";GenericCookieHandler.call(this);let e=this,t=!1,i=new BrowserDetector;function n(n){e.currentTabId=n[0].id,e.currentTab=n[0],i.isFirefox()?(i.getApi().cookies.onChanged.addListener(r),i.getApi().tabs.onUpdated.addListener(a),i.getApi().tabs.onActivated.addListener(o)):(i.getApi().tabs.onUpdated.addListener(a),i.getApi().tabs.onActivated.addListener(o),i.isSafari()||i.getApi().cookies.onChanged.addListener(r)),t=!0,e.emit("ready")}function r(t){let i=t.cookie.domain.substring(1);-1!==e.currentTab.url.indexOf(i)&&t.cookie.storeId===(e.currentTab.cookieStoreId||"0")&&e.emit("cookiesChanged",t)}function a(t,n,r){t===e.currentTabId&&(n.url||"complete"===n.status)&&(i.isFirefox()?i.getApi().tabs.query({active:!0,currentWindow:!0}).then(d):i.getApi().tabs.query({active:!0,currentWindow:!0},d))}function o(e){i.isFirefox()?i.getApi().tabs.query({active:!0,currentWindow:!0}).then(d):i.getApi().tabs.query({active:!0,currentWindow:!0},d)}function d(i){let n=i[0].id!==e.currentTabId||i[0].url!==e.currentTab.url;e.currentTabId=i[0].id,e.currentTab=i[0],n&&t&&e.emit("cookiesChanged")}i.isFirefox()?i.getApi().tabs.query({active:!0,currentWindow:!0}).then(n):i.getApi().tabs.query({active:!0,currentWindow:!0},n)}